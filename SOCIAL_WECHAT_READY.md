<!-- 封面图片位置: assets/wechat_cover.svg -->

# 缠论交易系统 v2.0 —— 从数据采集到回测的完整端到端实战

> 导读：一个能在 GitHub Actions 上自动跑的 A 股缠论信号平台——从高并发数据采集、缠论三类买卖点识别，到回测与风险管理，我们把工程化做了一遍，并把“一键运行”交付给你。

（顶部封面图：请在编辑器顶部上传 `assets/wechat_cover.svg` 并设置为封面，大图可吸引读者）

---

<!-- 段落间配图建议：在“实测数据与性能”后插入 `assets/wechat_fig_report.svg`；在“运行演示”或“日志说明”后插入 `assets/wechat_fig_log.svg` -->

**适合人群**：量化初学者、策略工程师、对缠论实践感兴趣的交易研究者。

**阅读收获**：
- 能快速在本地或 GitHub Actions 上启动一个端到端缠论信号系统；
- 理解系统设计要点（异步采集、WAL 存储、分形/中枢/多周期判定）；
- 获取性能与运行示例，能复制并开始积累历史数据用于回测。

---

## 1. 背景与目标（2分钟了解）

我们希望把一个缠论信号研究思路工程化：

- 数据：对接国内行情源，支持热模式（26 支常用标的，极速验证）与全量模式（5000+ A 股，离线积累历史）。
- 算法：实现缠论“三类买卖点”——线段完成、中枢突破、多周期共振，增强置信度。
- 评估：回测引擎 + 风险管理（Kelly 风格仓位、止损/止盈），并把报告自动产出为工件。
- 部署：在 GitHub Actions 上实现定时/手动触发自动化流水线。

---

## 2. 系统一览（架构图口述）

1. 异步采集（aiohttp，20 并发）→ 2. SQLite（WAL 模式，高效写入）→ 3. 缠论信号引擎（分形/中枢/多周期）
→ 4. 回测 + 风险管理（Position/RiskManager/BacktestEngine）→ 5. GitHub Actions 自动化 + 报表上传。

---

## 3. 为什么这样设计？（用一句话解释每一层）

- 异步采集：提高 IO 吞吐，短时间内拿到多个标的行情，便于快速验证；
- WAL 存储：减少写锁与事务开销，支持高并发写入；
- 数据校验：行情来源字段格式各异，增加 `safe_value` 容错能显著降低崩溃概率；
- 多周期共振：多个时间级别同时出现信号，比单级别更可靠；
- 回测 + 风控：只有结合仓位与止损，信号才具备可用性。

---

## 4. 关键实现要点（工程细节，便于复现）

- 异步采集：并发数 `max_concurrent=20`，批量请求 `batch_size=50`，单次请求 `timeout=10s`。

- SQLite 优化：启用 `PRAGMA journal_mode=WAL; PRAGMA synchronous=NORMAL; PRAGMA cache_size=-10000;` 来提升写入吞吐。

- 分型检测（核心）:
  - 使用相邻三根 K 线判断顶/底分型（中间柱对比前后柱的高低）；
  - 对输入字段做 `safe_value` 转换，容忍字符串或列表等格式，避免解析报错。

- 中枢识别：以区间内最高点和最低点的重叠范围判断中枢，阈值 `pivot_threshold=2%`，最少 `pivot_min_bars=5`。

- 第三类信号：要求 1m/5m/60m 等多周期同时出现第一或第二类买点，提高置信度（常用置信度阈值 > 0.8）。

- 风控与回测：采用 Kelly 类计算仓位（并支持 fractional Kelly），默认单笔最大亏损 2%，最大持仓 10%，止损 3%，目标收益 = 2 × 风险。

---

## 5. 快速上手（去掉复杂代码块，直接贴命令）

1) 本地快速验证（热模式，26 只，约 1 秒）

命令：

python3 run_complete_system.py --mode all --collect-mode hot --no-backtest

说明：该命令会在 `logs/` 下生成 `collector.log` 与 `analysis_report.txt`，适合快速看效果。

2) 完整采集（全量，5000+，约 6–9 分钟）

命令：

python3 run_complete_system.py --mode all --collect-mode all

说明：适合一次性在服务器/云端运行以积累历史数据用于回测。

---

## 6. 实测数据与性能（展示图放在这里）

（在此处插入配图：`assets/wechat_fig_report.svg`）

- 热模式（26 只）采集耗时约 0.9s。
- 估算全量（5000+）采集耗时约 6–9 分钟（与网络、代理有关）。
- 分析速度快，单次批量分析几十到几千只股票均可在分钟级完成。

图说：上图为示例的 analysis_report（Top 采集统计与信号分布），请在编辑器中插入 `assets/wechat_fig_report.svg`，并在图下写一行说明：“示例：采集统计与信号分布（示意）”。

---

## 7. 运行演示（日志示例）

（在此处插入配图：`assets/wechat_fig_log.svg`）

日志示例：脚本会打印类似：

09:11:48 上证指数(sh000001): 4113.97（盘前）
09:11:48 贵州茅台(sh600519): 1376.00（昨收）

图说：在编辑器里插入 `assets/wechat_fig_log.svg`，并在图下写一行说明：“示例：终端实时输出日志（示意）”。

---

## 8. 常见问题（FAQ）

Q: 采集 0 条数据怎么办？
A: 先在本地用 `curl 'https://hq.sinajs.cn/list=sh000001'` 测试行情源是否可用；如被封禁可使用代理并检查 `HTTP_PROXY`/`HTTPS_PROXY`。

Q: 为什么没信号？
A: 缠论信号对历史深度敏感，建议至少为每只股票积累 10–15 条分钟 K 线再分析。

Q: GitHub Actions 运行超时？
A: 默认 `timeout-minutes: 30`，若运行全量可改成 45 或 60。

---

## 9. 下一步计划（我们建议的迭代）

1. 在 GitHub Actions 中加入周期性回测并保存历史性能指标；
2. 集成企业微信/钉钉推送；
3. 增加自动参数搜索（Grid/Random search）以优化止损/持仓参数；
4. 长期：对接下单接口，先以模拟账户为主。

---

## 10. 图与素材说明（编辑器上传指南）

- 顶部封面（必须）：上传 `assets/wechat_cover.svg`，并设为文章封面。
- 图1（分析报告示意）：上传 `assets/wechat_fig_report.svg`，插入在“实测数据与性能”部分下方。
- 图2（终端日志示意）：上传 `assets/wechat_fig_log.svg`，插入在“运行演示（日志示例）”部分下方。

图片占比建议：封面 100% 宽度；配图宽度 70%（居中）并配 1–2 行简短说明文字。

---

## 致谢与联系方式

感谢关注！如需我把仓库链接、报告截图或实盘演示整理成一套发布包（含配图与截图），我可以一次性准备好发布素材并帮你上传。

（发布前请把文中顶部 `<REPO_URL>` 替换为你的仓库地址）

---

<!-- 文件结束 -->
